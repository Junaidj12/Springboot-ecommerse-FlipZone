<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Customer - FlipZone</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
html, body {
	height: 100%;
}

body {
	display: flex;
	flex-direction: column;
}

main {
	flex: 1;
	padding: 40px 20px;
}

.navbar-brand {
	font-weight: bold;
	font-size: 1.5rem;
}

.product-card {
	border: 1px solid #ddd;
	border-radius: 10px;
	padding: 15px;
	text-align: center;
	transition: transform 0.2s ease;
	height: 100%;
	background-color: #fff;
}

.product-card:hover {
	transform: scale(1.02);
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.product-img-wrapper {
	height: 250px;
	width: 100%;
	display: flex;
	justify-content: center;
	align-items: center;
	margin-bottom: 10px;
}

.product-img {
	max-height: 100%;
	max-width: 100%;
	object-fit: contain;
	border-radius: 5px;
}

footer {
	background-color: #343a40;
	color: #fff;
	padding: 15px 0;
	text-align: center;
}

.toast {
	position: fixed;
	top: 50px;
	right: 20px;
	padding: 1rem 1.5rem;
	border-radius: 8px;
	color: white;
	font-weight: bold;
	z-index: 9999;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
	opacity: 1;
	transition: opacity 0.5s ease-out;
}

.toast.success {
	background-color: #28a745;
}

.toast.fail {
	background-color: #dc3545;
}
</style>
</head>
<body>

	<nav class="navbar navbar-light bg-light px-4 justify-content-between">
		<span class="navbar-brand mb-0 h1">FlipZone</span>
		<div>
			<a href="/customer/cart" class="btn btn-outline-primary me-2">Cart</a>
			<a href="/logout" class="btn btn-danger">Logout</a>
		</div>
	</nav>

	<div class="toast success" id="toastSuccess" th:if="${session.pass}"
		th:text="${session.pass}"></div>
	<div class="toast fail" id="toastFail" th:if="${session.fail}"
		th:text="${session.fail}"></div>

	<main class="container">

		<form method="get" th:action="@{/customer/home}">
			<div class="row mb-4">
				<div class="col-md-3 mb-2">
					<input type="text" name="name" class="form-control"
						placeholder="Search by product name..." th:value="${name}">
				</div>
				<div class="col-md-3 mb-2">
					<select name="sort" class="form-select">
						<option value="">Sort by</option>
						<option value="price-asc" th:selected="${sort == 'price-asc'}">Price:
							Low to High</option>
						<option value="price-desc" th:selected="${sort == 'price-desc'}">Price:
							High to Low</option>
						<option value="stock" th:selected="${sort == 'stock'}">Stock:
							High to Low</option>
					</select>
				</div>

				<div class="col-md-3 mb-2">
					<input type="hidden" name="desc" th:value="${desc}" />
					<button class="btn btn-primary w-100" type="submit">Apply
						Filters</button>
				</div>
			</div>
		</form>

		<h2 class="mb-4 text-center">Available Products</h2>

		<div class="row g-4">
			<div class="col-md-4 col-sm-6" th:each="product : ${products}">
				<div class="product-card">
					<div class="product-img-wrapper">
						<img
							th:src="${product.imgLink != null ? product.imgLink : 'https://via.placeholder.com/150'}"
							class="product-img" alt="Product">
					</div>
					<h5 th:text="${product.name}">Product Name</h5>
					<p th:text="${product.description}">Description</p>
					<p>
						<strong th:text="'₹' + ${product.price}">₹0</strong>
					</p>
					<p>
						Stock: <span th:text="${product.stock}">0</span>
					</p>
					<form th:action="@{/customer/add-to-cart}" method="post">
						<input type="hidden" name="productId" th:value="${product.id}" />
						<button class="btn btn-primary" type="submit">Add to Cart</button>
					</form>

				</div>
			</div>
		</div>

		<nav th:if="${totalPages > 1}" class="mt-5">
			<ul class="pagination justify-content-center">
				<li class="page-item"
					th:classappend="${currentPage == 0} ? 'disabled'"><a
					class="page-link"
					th:href="@{/customer/home(name=${name}, sort=${sort}, stock=${stock}, desc=${desc}, page=${currentPage - 1}, size=6)}">«</a>
				</li>

				<li class="page-item"
					th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
					th:classappend="${i == currentPage} ? 'active'"><a
					class="page-link"
					th:href="@{/customer/home(name=${name}, sort=${sort}, stock=${stock}, desc=${desc}, page=${i}, size=6)}"
					th:text="${i + 1}">1</a></li>

				<li class="page-item"
					th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
					<a class="page-link"
					th:href="@{/customer/home(name=${name}, sort=${sort}, stock=${stock}, desc=${desc}, page=${currentPage + 1}, size=6)}">»</a>
				</li>
			</ul>
		</nav>

	</main>

	<footer>
		<div class="container">
			<p>&copy; 2025 FlipZone. All rights reserved.</p>
		</div>
	</footer>

	<script>
	const toastSuccess = document.getElementById('toastSuccess');
	const toastFail = document.getElementById('toastFail');

	[toastSuccess, toastFail].forEach(toast => {
		if (toast) {
			toast.style.display = 'block';  // ✅ Make it visible
			setTimeout(() => {
				toast.style.opacity = '0';
				fetch('/clear-toast');
			}, 3000);
		}
	});
</script>


</body>
</html>
